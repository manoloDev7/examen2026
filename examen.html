<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Examen de Programaci√≥n Web</title>
    <style>
      /* üé® Paleta base (modo oscuro por defecto) */
      :root {
        --bg-dark: oklch(0.1 0 264);
        --bg: oklch(0.2 0 264);
        --bg-light: oklch(0.3 0 264);

        --text: oklch(0.96 0 264);
        --text-muted: oklch(0.76 0 264);
        --accent: oklch(0.65 0.2 264);
        --danger: oklch(0.6 0.2 20);

        --shadow-small:
          inset 0 1px 2px #ffffff30, 0 1px 2px #00000030, 0 2px 4px #00000020;
        --shadow-medium:
          inset 0 1px 2px #ffffff50, 0 2px 4px #00000030, 0 4px 8px #00000015;
        --shadow-large:
          inset 0 1px 2px #ffffff70, 0 4px 6px #00000030, 0 6px 10px #00000015;
      }

      /* ‚òÄÔ∏è Modo claro */
      body.light-mode {
        --bg-dark: oklch(0.92 0 264);
        --bg: oklch(0.96 0 264);
        --bg-light: oklch(1 0 264);

        --text: oklch(0.15 0 264);
        --text-muted: oklch(0.4 0 264);
        --accent: oklch(0.55 0.2 264);
        --danger: oklch(0.55 0.2 20);

        --shadow-small:
          inset 0 1px 2px #00000010, 0 1px 2px #ffffff70, 0 2px 4px #00000010;
        --shadow-medium:
          inset 0 1px 2px #00000015, 0 2px 4px #ffffff70, 0 4px 8px #00000010;
        --shadow-large:
          inset 0 1px 2px #00000020, 0 4px 6px #ffffff60, 0 6px 10px #00000010;
      }

      /* üåê Estilos generales */
      body {
        font-family: "Segoe UI", system-ui, sans-serif;
        background-color: var(--bg-dark);
        color: var(--text);
        margin: 0;
        padding: 0; /* Remove padding to handle full-screen overlay */
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        transition:
          background-color 0.4s ease,
          color 0.4s ease;
      }

      /* --- Login Overlay --- */
      #loginOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--bg-dark);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .login-box {
        background-color: var(--bg);
        padding: 2rem;
        border-radius: 10px;
        box-shadow: var(--shadow-large);
        text-align: center;
        max-width: 400px;
        width: 90%;
      }

      .login-box h2 {
        margin-top: 0;
        color: var(--accent);
      }

      .login-box input {
        width: 100%;
        padding: 10px;
        margin: 15px 0;
        border: 1px solid var(--bg-light);
        border-radius: 5px;
        background-color: var(--bg-light);
        color: var(--text);
        font-size: 1rem;
      }

      .login-box button {
        width: 100%;
        padding: 10px;
        background-color: var(--accent);
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 1rem;
        cursor: pointer;
        transition: 0.3s;
      }

      .login-box button:hover {
        filter: brightness(1.1);
      }

      /* --- App Layout --- */
      #appContainer {
        display: none; /* Hidden until login */
        width: 100%;
        max-width: 800px;
        padding: 20px;
        box-sizing: border-box;
        flex-direction: column;
        align-items: center;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        margin-bottom: 2rem;
        padding: 1rem;
        background-color: var(--bg);
        border-radius: 10px;
        box-shadow: var(--shadow-medium);
      }

      h1 {
        margin: 0;
        font-size: 1.5rem;
      }

      .timer-container {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--accent);
        padding: 0.5rem 1rem;
        border-radius: 5px;
        background-color: var(--bg-dark);
        box-shadow: var(--shadow-small);
        min-width: 100px;
        text-align: center;
      }

      .timer-danger {
        color: var(--danger);
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      .question-card {
        background-color: var(--bg);
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 10px;
        box-shadow: var(--shadow-small);
        transition: transform 0.2s;
      }

      .question-card:hover {
        box-shadow: var(--shadow-medium);
      }

      h3 {
        margin-top: 0;
        color: var(--accent);
      }

      label {
        display: block;
        margin: 10px 0;
        padding: 10px;
        background-color: var(--bg-light);
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      label:hover {
        background-color: var(--bg-dark);
        filter: brightness(1.1);
      }

      input[type="radio"] {
        margin-right: 10px;
        accent-color: var(--accent);
      }

      #toggleMode {
        background-color: var(--bg-light);
        color: var(--text);
        border: none;
        border-radius: 5px;
        padding: 8px 16px;
        cursor: pointer;
        box-shadow: var(--shadow-small);
        transition: 0.3s;
        margin-left: 1rem;
      }

      .controls {
        display: flex;
        align-items: center;
      }

      .submit-btn {
        display: block;
        width: 100%;
        padding: 15px;
        margin-top: 2rem;
        background-color: var(--accent);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1.2rem;
        font-weight: bold;
        cursor: pointer;
        box-shadow: var(--shadow-medium);
        transition: 0.3s;
      }

      .submit-btn:hover {
        filter: brightness(1.1);
        transform: translateY(-2px);
      }

      #result {
        display: none;
        margin-top: 20px;
        padding: 20px;
        background-color: var(--bg);
        border-radius: 10px;
        text-align: center;
        font-size: 1.5rem;
        font-weight: bold;
        box-shadow: var(--shadow-large);
        border: 2px solid var(--accent);
      }

      /* --- Toast Notification --- */
      #toast {
        visibility: hidden;
        min-width: 250px;
        margin-left: -125px;
        background-color: var(--danger);
        color: #fff;
        text-align: center;
        border-radius: 2px;
        padding: 16px;
        position: fixed;
        z-index: 2000;
        left: 50%;
        bottom: 30px;
        font-size: 17px;
        box-shadow: var(--shadow-medium);
      }

      #toast.show {
        visibility: visible;
        animation:
          fadein 0.5s,
          fadeout 0.5s 4.5s;
      }

      @keyframes fadein {
        from {
          bottom: 0;
          opacity: 0;
        }
        to {
          bottom: 30px;
          opacity: 1;
        }
      }

      @keyframes fadeout {
        from {
          bottom: 30px;
          opacity: 1;
        }
        to {
          bottom: 0;
          opacity: 0;
        }
      }

      /* --- Resultados Visuales --- */
      .correct-answer {
        background-color: oklch(0.8 0.1 150) !important; /* Verde */
        color: black;
        border: 2px solid oklch(0.6 0.2 150);
      }

      .incorrect-answer {
        background-color: oklch(0.8 0.1 20) !important; /* Rojo */
        color: black;
        border: 2px solid oklch(0.6 0.2 20);
      }

      /* --- Result Modal --- */
      #resultModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 3000;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(5px);
      }

      .modal-content {
        background-color: var(--bg);
        padding: 2rem;
        border-radius: 15px;
        box-shadow: var(--shadow-large);
        text-align: center;
        max-width: 500px;
        width: 90%;
        border: 2px solid var(--accent);
        max-height: 90vh;
        overflow-y: auto;
        animation: slideIn 0.3s ease-out;
      }

      @keyframes slideIn {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .modal-score {
        font-size: 3rem;
        font-weight: bold;
        color: var(--accent);
        margin: 1rem 0;
      }

      .summary-list {
        text-align: left;
        margin: 1rem 0;
        padding: 0;
        list-style: none;
      }

      .summary-item {
        padding: 0.5rem;
        margin-bottom: 0.5rem;
        border-radius: 5px;
        background-color: var(--bg-light);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .summary-item.correct {
        border-left: 5px solid oklch(0.8 0.1 150);
      }
      .summary-item.incorrect {
        border-left: 5px solid oklch(0.6 0.2 20);
      }

      .close-btn {
        background-color: var(--text-muted);
        color: var(--bg);
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 1rem;
        font-weight: bold;
      }

      .close-btn:hover {
        filter: brightness(1.1);
      }
    </style>
  </head>
  <body>
    <!-- Login Screen -->
    <div id="loginOverlay">
      <div class="login-box">
        <h2>Examen de Acceso</h2>
        <p>Introduce la clave para comenzar</p>
        <input type="password" id="accessKey" placeholder="Clave de acceso" />
        <button onclick="checkAccess()">Comenzar Examen</button>
        <p
          id="loginError"
          style="color: var(--danger); display: none; margin-top: 10px"
        >
          Clave incorrecta
        </p>
      </div>
    </div>

    <!-- Main App -->
    <div id="appContainer">
      <header>
        <h1>Examen Web</h1>
        <div class="controls">
          <div id="timer" class="timer-container">30:00</div>
          <button id="toggleMode">‚òÄÔ∏è</button>
        </div>
      </header>

      <main>
        <form id="examForm">
          <div id="questionsContainer"></div>
          <button type="submit" class="submit-btn" id="submitBtn">
            Enviar Examen
          </button>
        </form>

        <div id="result"></div>
      </main>
    </div>

    <!-- Toast Element -->
    <div id="toast"></div>

    <!-- Result Modal -->
    <div id="resultModal">
      <div class="modal-content">
        <h2 id="modalTitle">Examen Finalizado</h2>
        <div class="modal-score" id="modalScore">0/10</div>
        <p id="modalMessage">Mensaje</p>
        <ul class="summary-list" id="modalSummary"></ul>
        <button class="close-btn" onclick="closeModal()">
          Cerrar y Revisar
        </button>
      </div>
    </div>

    <script>
      // --- Configuraci√≥n y Datos ---
      const ACCESS_KEY = "examen2026"; // Clave de acceso
      const EXAM_TIME_MINUTES = 0.5; // 30 segundos para probar

      const allQuestions = [
        {
          id: "q1",
          text: "1. ¬øQu√© significa HTML?",
          options: [
            { value: "a", text: "Hyper Text Markup Language" },
            { value: "b", text: "High Tech Modern Language" },
            { value: "c", text: "Hyperloop Machine Learning" },
          ],
          correct: "a",
        },
        {
          id: "q2",
          text: "2. ¬øCu√°l es la etiqueta correcta para el encabezado m√°s grande?",
          options: [
            { value: "a", text: "&lt;head&gt;" },
            { value: "b", text: "&lt;h6&gt;" },
            { value: "c", text: "&lt;h1&gt;" },
          ],
          correct: "c",
        },
        {
          id: "q3",
          text: "3. ¬øPara qu√© sirve CSS?",
          options: [
            { value: "a", text: "Para estructurar el contenido" },
            { value: "b", text: "Para dar estilo y dise√±o visual" },
            { value: "c", text: "Para programar la l√≥gica del servidor" },
          ],
          correct: "b",
        },
        {
          id: "q4",
          text: '4. ¬øC√≥mo se selecciona un elemento con id="menu"?',
          options: [
            { value: "a", text: ".menu" },
            { value: "b", text: "#menu" },
            { value: "c", text: "menu" },
          ],
          correct: "b",
        },
        {
          id: "q5",
          text: "5. ¬øCu√°l es la forma correcta de declarar una variable en JS moderno?",
          options: [
            { value: "a", text: "variable myVar;" },
            { value: "b", text: "let myVar;" },
            { value: "c", text: "v myVar;" },
          ],
          correct: "b",
        },
        {
          id: "q6",
          text: "6. ¬øCu√°l es el operador de igualdad estricta en JS?",
          options: [
            { value: "a", text: "==" },
            { value: "b", text: "===" },
            { value: "c", text: "=" },
          ],
          correct: "b",
        },
        {
          id: "q7",
          text: "7. ¬øQu√© propiedad de CSS cambia el color del texto?",
          options: [
            { value: "a", text: "text-color" },
            { value: "b", text: "font-color" },
            { value: "c", text: "color" },
          ],
          correct: "c",
        },
        {
          id: "q8",
          text: "8. ¬øCu√°l es el elemento HTML para una lista desordenada?",
          options: [
            { value: "a", text: "&lt;ol&gt;" },
            { value: "b", text: "&lt;ul&gt;" },
            { value: "c", text: "&lt;list&gt;" },
          ],
          correct: "b",
        },
        {
          id: "q9",
          text: "9. ¬øC√≥mo se llama a una funci√≥n en JavaScript?",
          options: [
            { value: "a", text: "call myFunction()" },
            { value: "b", text: "myFunction()" },
            { value: "c", text: "call function myFunction()" },
          ],
          correct: "b",
        },
        {
          id: "q10",
          text: "10. ¬øQu√© atributo HTML se usa para definir estilos en l√≠nea?",
          options: [
            { value: "a", text: "class" },
            { value: "b", text: "styles" },
            { value: "c", text: "style" },
          ],
          correct: "c",
        },
      ];

      // --- L√≥gica de Usuario / Renderizado ---
      let randomizedQuestions = [];

      function checkAccess() {
        const input = document.getElementById("accessKey");
        const errorMsg = document.getElementById("loginError");

        if (input.value === ACCESS_KEY) {
          document.getElementById("loginOverlay").style.display = "none";
          document.getElementById("appContainer").style.display = "flex";
          initExam();
        } else {
          errorMsg.style.display = "block";
          input.value = "";
          input.focus();
        }
      }

      function initExam() {
        // 1. Aleatorizar preguntas
        randomizedQuestions = [...allQuestions].sort(() => 0.5 - Math.random());

        // 2. Renderizar preguntas
        const container = document.getElementById("questionsContainer");
        container.innerHTML = "";

        randomizedQuestions.forEach((q, index) => {
          const card = document.createElement("div");
          card.className = "question-card";

          // Ajustamos el n√∫mero mostrado (1..10) indep. del orden
          const displayQuestionText = q.text.replace(
            /^\d+\.\s*/,
            `${index + 1}. `,
          );

          let html = `<h3>${displayQuestionText}</h3>`;
          q.options.forEach((opt) => {
            html += `
            <label>
              <input type="radio" name="${q.id}" value="${opt.value}">
              ${opt.text}
            </label>
          `;
          });

          card.innerHTML = html;
          container.appendChild(card);
        });

        // 3. Iniciar contador
        startTimer();
      }

      // --- Temporizador ---
      let timeLeft = EXAM_TIME_MINUTES * 60;
      let timerInterval;
      const timerElement = document.getElementById("timer");

      function startTimer() {
        timerInterval = setInterval(() => {
          const minutes = Math.floor(timeLeft / 60);
          const seconds = timeLeft % 60;

          timerElement.textContent = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

          if (timeLeft < 300) {
            timerElement.classList.add("timer-danger");
          }

          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            finishExam(null, true); // true = forced by timeout
          }
          timeLeft--;
        }, 1000);
      }

      // --- Finalizaci√≥n y Bloqueo ---
      const examForm = document.getElementById("examForm");
      const resultDiv = document.getElementById("result");
      const submitBtn = document.getElementById("submitBtn");

      function finishExam(e, isTimeout = false) {
        if (e) e.preventDefault();

        clearInterval(timerInterval);

        // Bloquear TODO
        const inputs = examForm.querySelectorAll("input");
        inputs.forEach((input) => (input.disabled = true));
        submitBtn.disabled = true;
        submitBtn.textContent = isTimeout
          ? "¬°Tiempo Agotado!"
          : "Examen Finalizado";

        // Calcular Score
        const formData = new FormData(examForm);
        let score = 0;

        randomizedQuestions.forEach((q) => {
          if (formData.get(q.id) === q.correct) {
            score++;
            // Marcar correcta visualmente (input seleccionado)
            const correctInput = document.querySelector(
              `input[name="${q.id}"][value="${q.correct}"]`,
            );
            if (correctInput)
              correctInput.parentElement.classList.add("correct-answer");
          } else {
            // Marcar incorrecta si se seleccion√≥ algo
            const selectedValue = formData.get(q.id);
            if (selectedValue) {
              const wrongInput = document.querySelector(
                `input[name="${q.id}"][value="${selectedValue}"]`,
              );
              if (wrongInput)
                wrongInput.parentElement.classList.add("incorrect-answer");
            }
            // Mostrar la correcta tambi√©n
            const correctInput = document.querySelector(
              `input[name="${q.id}"][value="${q.correct}"]`,
            );
            if (correctInput)
              correctInput.parentElement.classList.add("correct-answer");
          }
        });

        // Mostrar resultados
        resultDiv.style.display = "block";
        resultDiv.textContent = `Tu calificaci√≥n es: ${score} / ${allQuestions.length}`;

        if (score === allQuestions.length) {
          resultDiv.style.color = "var(--accent)";
          resultDiv.textContent += " ¬°Excelente! üéâ";
        } else if (score >= allQuestions.length / 2) {
          resultDiv.style.color = "var(--text)";
          resultDiv.textContent += " ¬°Bien hecho! üëç";
        } else {
          resultDiv.style.color = "var(--danger)";
          resultDiv.textContent += " Sigue estudiando üìö";
        }

        if (isTimeout) {
          resultDiv.innerHTML +=
            "<br><small>(El examen se cerr√≥ autom√°ticamente por tiempo)</small>";
          showToast("¬°Tiempo Agotado! El examen se ha cerrado.");
        }

        window.scrollTo({
          top: document.body.scrollHeight,
          behavior: "smooth",
        });

        // Show Modal
        showResultModal(score, allQuestions.length, isTimeout);
      }

      function showResultModal(score, total, isTimeout) {
        const modal = document.getElementById("resultModal");
        const title = document.getElementById("modalTitle");
        const scoreDisplay = document.getElementById("modalScore");
        const message = document.getElementById("modalMessage");
        const summary = document.getElementById("modalSummary");

        title.textContent = isTimeout
          ? "¬°Tiempo Agotado!"
          : "Examen Finalizado";
        scoreDisplay.textContent = `${score} / ${total}`;

        if (score === total) message.textContent = "¬°Excelente! üéâ";
        else if (score >= total / 2) message.textContent = "¬°Bien hecho! üëç";
        else message.textContent = "Sigue estudiando üìö";

        // Generate Summary
        summary.innerHTML = "";
        const formData = new FormData(document.getElementById("examForm"));

        // We use allQuestions here to show the summary in original or random order?
        // Let's use randomizedQuestions to match what user just saw
        randomizedQuestions.forEach((q, index) => {
          const li = document.createElement("li");
          const isCorrect = formData.get(q.id) === q.correct;
          li.className = `summary-item ${isCorrect ? "correct" : "incorrect"}`;
          li.innerHTML = `
            <span>Pregunta ${index + 1}</span>
            <span>${isCorrect ? "‚úÖ" : "‚ùå"}</span>
          `;
          summary.appendChild(li);
        });

        modal.style.display = "flex";
      }

      function closeModal() {
        document.getElementById("resultModal").style.display = "none";
      }

      function showToast(message) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.className = "show";
        setTimeout(function () {
          toast.className = toast.className.replace("show", "");
        }, 5000);
      }

      examForm.addEventListener("submit", finishExam);

      // --- Modo Oscuro Toggle ---
      const toggleBtn = document.getElementById("toggleMode");
      toggleBtn.addEventListener("click", () => {
        document.body.classList.toggle("light-mode");
        toggleBtn.textContent = document.body.classList.contains("light-mode")
          ? "üåô"
          : "‚òÄÔ∏è";
      });
    </script>
  </body>
</html>
